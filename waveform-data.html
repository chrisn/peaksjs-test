<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>waveform-data test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://unpkg.com/waveform-data@2.0.1/dist/waveform-data.js"></script>
    <style>
        body {
            background-color: beige;
        }

        canvas {
            border: 1px solid red;
        }
    </style>
</head>
<body>

    <canvas id="canvas" width="800" height="300"></canvas>

    <script>

        let waveform;

        function draw() {

            const canvas = document.getElementById('canvas');

            // const interpolateWidth = (total_width) => {
            //     return (x) => x / total_width;
            //     //return (size) => total_width - ((size + 128) * total_height) / amplitude;
            // };

            const interpolateHeight = (total_height) => {
                const amplitude = 256;
                return (size) => total_height - ((size + 128) * total_height) / amplitude;
            };

            const y = interpolateHeight(canvas.height);
            const ctx = canvas.getContext('2d');

            ctx.fillStyle = "#009900";
            ctx.strokeStyle = "#0000ff";

            ctx.beginPath();

            // from 0 to 100
            waveform.min.forEach((val, x) => {
                x2 = x + 0.5;
                var y2 = y(val) + 0.5;
                ctx.lineTo(x2, y2);
            });

            // then looping back from 100 to 0
            waveform.max.reverse().forEach((val, x) => {
                ctx.lineTo((waveform.offset_length - x) + 0.5, y(val) + 0.5);
            });

            ctx.closePath();
            ctx.fill();
        }

        document.addEventListener("DOMContentLoaded", function(event) {
            
            const xhr = new XMLHttpRequest();

            // .dat file generated by audiowaveform program
            xhr.responseType = 'arraybuffer';
            xhr.open("GET", 'vdc_100052359795.0x000018.dat');

            xhr.addEventListener('load', (progressEvent) => {
                waveform = WaveformData.create(progressEvent.target);
                draw();
            });

            xhr.send();

        });
        
    </script>
</body>
</html>